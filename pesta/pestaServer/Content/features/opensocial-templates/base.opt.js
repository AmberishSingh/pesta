opensocial=opensocial||{};opensocial.template=opensocial.template||{};var os=opensocial.template;os.log=function(b){var a=window.console;if(a&&a.log){a.log(b)}};window.log=os.log;os.warn=function(a){os.log("WARNING: "+a)};os.isArray=function(a){return typeof(a)=="object"&&typeof(a.length)=="number"&&typeof(a.push)=="function"};os.ATT_customtag="customtag";os.VAR_my="$my";os.VAR_cur="$cur";os.VAR_node="$node";os.VAR_msg="Msg";os.VAR_parentnode="$parentnode";os.VAR_uniqueId="$uniqueId";os.VAR_identifierresolver="$_ir";os.VAR_callbacks="$callbacks_";os.regExps_={ONLY_WHITESPACE:/^[ \t\n]*$/,VARIABLE_SUBSTITUTION:/^([\w\W]*?)(\$\{[^\}]*\})([\w\W]*)$/};os.compileTemplate=function(b,d){if(typeof(b)=="string"){return os.compileTemplateString(b,d)}d=d||b.name;var c=b.value||b.innerHTML;c=os.trim(c);var a=os.compileTemplateString(c,d);if(!b.name){b.name=a.id}return a};os.compileTemplateString=function(b,c){b=opensocial.xmlutil.prepareXML(b);var a=opensocial.xmlutil.parseXML(b);return os.compileXMLDoc(a,c)};os.renderTemplateNode_=function(c,a){var b=domCloneElement(c);if(b.removeAttribute){b.removeAttribute(STRING_id)}jstProcess(a,b);return b};os.elementIdCounter_=0;os.createTemplateCustomTag=function(a){return function(d,e,c){c.setVariable(os.VAR_my,d);c.setVariable(os.VAR_node,d);c.setVariable(os.VAR_uniqueId,os.elementIdCounter_++);var b=a.render(e,c);os.markNodeToSkip(b);return b}};os.createNodeAccessor_=function(a){return function(b){return os.getValueFromNode_(a,b)}};os.gadgetPrefs_=null;if(window.gadgets&&window.gadgets["Prefs"]){os.gadgetPrefs_=new window.gadgets["Prefs"]()}os.getPrefMessage=function(a){if(!os.gadgetPrefs_){return null}return os.gadgetPrefs_.getMsg(a)};os.globalDisallowedAttributes_={data:1};os.customAttributes_={};os.registerAttribute_=function(b,a){os.customAttributes_[b]=a};os.doAttribute=function(c,b,d,a){if(!os.customAttributes_.hasOwnProperty(b)){return}var e=os.customAttributes_[b];e(c,c.getAttribute(b),d,a)};os.doTag=function(c,h,k,f,a){var d=os.getCustomTag(h,k);if(!d){os.warn("Custom tag <"+h+":"+k+"> not defined.");return}for(var b=c.firstChild;b;b=b.nextSibling){if(b.nodeType==DOM_ELEMENT_NODE){jstProcess(a,b);os.markNodeToSkip(b)}}var l=d.call(null,c,f,a);if(!l&&typeof(l)!="string"){throw"Custom tag <"+h+":"+k+"> failed to return anything."}if(typeof(l)=="string"){c.innerHTML=l?l:""}else{if(os.isArray(l)){os.removeChildren(c);for(var e=0;e<l.length;e++){if(l[e].nodeType==DOM_ELEMENT_NODE||l[e].nodeType==DOM_TEXT_NODE){c.appendChild(l[e]);if(l[e].nodeType==DOM_ELEMENT_NODE){os.markNodeToSkip(l[e])}}}}else{var g=a.getVariable(os.VAR_callbacks);var j=null;if(l.nodeType==DOM_ELEMENT_NODE){j=l}else{if(l.root&&l.root.nodeType==DOM_ELEMENT_NODE){j=l.root}}if(j&&j!=c&&(!j.parentNode||j.parentNode.nodeType==DOM_DOCUMENT_FRAGMENT_NODE)){os.removeChildren(c);c.appendChild(j);os.markNodeToSkip(j)}if(l.onAttach){g.push(l)}}}};os.setContextNode_=function(b,a){if(b.nodeType==DOM_ELEMENT_NODE){a.setVariable(os.VAR_node,b)}};os.markNodeToSkip=function(a){a.setAttribute(ATT_skip,"true");a.removeAttribute(ATT_select);a.removeAttribute(ATT_eval);a.removeAttribute(ATT_values);a.removeAttribute(ATT_display);a[PROP_jstcache]=null;a.removeAttribute(ATT_jstcache)};