var gadgets=gadgets||{};gadgets.rpc=function(){var r="__cb";var p="";var D="__g2c_rpc";var f="__c2g_rpc";var h="GRPC____NIXVBS_wrapper";var b="GRPC____NIXVBS_get_wrapper";var y="GRPC____NIXVBS_handle_message";var o="GRPC____NIXVBS_create_channel";var j={};var c={};var w=[];var d={};var u={};var k={};var m=0;var E={};var t={};var e={};var C={};if(gadgets.util){C=gadgets.util.getUrlParameters()}k[".."]=C.rpctoken||C.ifpctok||0;function z(){return typeof window.postMessage==="function"?"wpm":typeof document.postMessage==="function"?"dpm":window.ActiveXObject?"nix":navigator.product==="Gecko"?"fe":"ifpc"}function B(){if(i==="dpm"||i==="wpm"){window.addEventListener("message",function(I){s(gadgets.json.parse(I.data))},false)}if(i==="nix"){if(typeof window[b]!=="unknown"){window[y]=function(I){s(gadgets.json.parse(I))};window[o]=function(I,K,J){if(k[I]==J){j[I]=K}};var G="Class "+h+"\n Private m_Intended\nPrivate m_Auth\nPublic Sub SetIntendedName(name)\n If isEmpty(m_Intended) Then\nm_Intended = name\nEnd If\nEnd Sub\nPublic Sub SetAuth(auth)\n If isEmpty(m_Auth) Then\nm_Auth = auth\nEnd If\nEnd Sub\nPublic Sub SendMessage(data)\n "+y+"(data)\nEnd Sub\nPublic Function GetAuthToken()\n GetAuthToken = m_Auth\nEnd Function\nPublic Sub CreateChannel(channel, auth)\n Call "+o+"(m_Intended, channel, auth)\nEnd Sub\nEnd Class\nFunction "+b+"(name, auth)\nDim wrap\nSet wrap = New "+h+"\nwrap.SetIntendedName name\nwrap.SetAuth auth\nSet "+b+" = wrap\nEnd Function";try{window.execScript(G,"vbscript")}catch(H){i="ifpc"}}}}var i=z();B();c[p]=function(){if(console&&console.log){console.log("Unknown RPC service: "+this.s)}};c[r]=function(H,G){var I=E[H];if(I){delete E[H];I(G)}};function n(H,G){if(t[H]){return}if(i==="fe"){try{var J=document.getElementById(H);J[D]=function(L){s(gadgets.json.parse(L))}}catch(I){}}if(i==="nix"){try{var J=document.getElementById(H);var K=window[b](H,G);J.contentWindow.opener=K}catch(I){}}t[H]=true}function v(I){var K=gadgets.json.stringify;var G=[];for(var J=0,H=I.length;J<H;++J){G.push(encodeURIComponent(K(I[J])))}return G.join("&")}function s(H){if(H&&typeof H.s==="string"&&typeof H.f==="string"&&H.a instanceof Array){if(k[H.f]){if(k[H.f]!=H.t){throw new Error("Invalid auth token.")}}if(H.c){H.callback=function(I){gadgets.rpc.call(H.f,r,null,H.c,I)}}var G=(c[H.s]||c[p]).apply(H,H.a);if(H.c&&typeof G!="undefined"){gadgets.rpc.call(H.f,r,null,H.c,G)}}}function F(G,J,M,K){try{if(M!=".."){var I=j[".."];if(!I&&window.opener&&"GetAuthToken" in window.opener){I=window.opener;if(I.GetAuthToken()==k[".."]){var H=k[".."];I.CreateChannel(window[b]("..",H),H);j[".."]=I;window.opener=null}}if(I){I.SendMessage(K);return}}else{if(j[G]){j[G].SendMessage(K);return}}}catch(L){}A(G,J,M,K)}function a(H,I,N,J,L){try{if(N!=".."){var G=window.frameElement;if(typeof G[D]==="function"){if(typeof G[D][f]!=="function"){G[D][f]=function(O){s(gadgets.json.parse(O))}}G[D](J);return}}else{var M=document.getElementById(H);if(typeof M[D]==="function"&&typeof M[D][f]==="function"){M[D][f](J);return}}}catch(K){}A(H,I,N,J,L)}function A(G,H,M,I,J){var L=gadgets.rpc.getRelayUrl(G);if(!L){if(console&&console.log){console.log("No relay file assigned for IFPC")}}var K=null;if(u[G]){K=[L,"#",v([M,m,1,0,v([M,H,"","",M].concat(J))])].join("")}else{K=[L,"#",G,"&",M,"@",m,"&1&0&",encodeURIComponent(I)].join("")}l(K)}function l(J){var H;for(var G=w.length-1;G>=0;--G){var K=w[G];try{if(K&&(K.recyclable||K.readyState==="complete")){K.parentNode.removeChild(K);if(window.ActiveXObject){w[G]=K=null;w.splice(G,1)}else{K.recyclable=false;H=K;break}}}catch(I){}}if(!H){H=document.createElement("iframe");H.style.border=H.style.width=H.style.height="0px";H.style.visibility="hidden";H.style.position="absolute";H.onload=function(){this.recyclable=true};w.push(H)}H.src=J;setTimeout(function(){document.body.appendChild(H)},0)}function g(H,J){if(typeof e[H]==="undefined"){e[H]=false;var I=null;if(H===".."){I=parent}else{I=frames[H]}try{e[H]=I.gadgets.rpc.receiveSameDomain}catch(G){}}if(typeof e[H]==="function"){e[H](J);return true}return false}if(gadgets.config){function x(G){if(G.rpc.parentRelayUrl.substring(0,7)==="http://"){d[".."]=G.rpc.parentRelayUrl}else{var K=document.location.search.substring(0).split("&");var J="";for(var H=0,I;I=K[H];++H){if(I.indexOf("parent=")===0){J=decodeURIComponent(I.substring(7));break}}if(J!==""){d[".."]=J+G.rpc.parentRelayUrl}}u[".."]=!!G.rpc.useLegacyProtocol}var q={parentRelayUrl:gadgets.config.NonEmptyStringValidator};gadgets.config.register("rpc",q,x)}return{register:function(H,G){if(H==r){throw new Error("Cannot overwrite callback service")}if(H==p){throw new Error("Cannot overwrite default service: use registerDefault")}c[H]=G},unregister:function(G){if(G==r){throw new Error("Cannot delete callback service")}if(G==p){throw new Error("Cannot delete default service: use unregisterDefault")}delete c[G]},registerDefault:function(G){c[""]=G},unregisterDefault:function(){delete c[""]},call:function(O,K,P,N){++m;O=O||"..";if(P){E[m]=P}var M="..";if(O===".."){M=window.name}var J={s:K,f:M,c:P?m:0,a:Array.prototype.slice.call(arguments,3),t:k[O]};if(g(O,J)){return}var H=gadgets.json.stringify(J);var I=i;if(u[O]){I="ifpc"}switch(I){case"dpm":var Q=O===".."?parent.document:frames[O].document;Q.postMessage(H);break;case"wpm":var L=O===".."?parent:frames[O];var G=gadgets.rpc.getRelayUrl(O);if(G){L.postMessage(H,G)}break;case"nix":F(O,K,M,H);break;case"fe":a(O,K,M,H,J.a);break;default:A(O,K,M,H,J.a);break}},getRelayUrl:function(G){return d[G]},setRelayUrl:function(H,G,I){d[H]=G;u[H]=!!I},setAuthToken:function(G,H){k[G]=H;n(G,H)},getRelayChannel:function(){return i},receive:function(G){if(G.length>4){s(gadgets.json.parse(decodeURIComponent(G[G.length-1])))}},receiveSameDomain:function(G){G.a=Array.prototype.slice.call(G.a);window.setTimeout(function(){s(G)},0)}}}();