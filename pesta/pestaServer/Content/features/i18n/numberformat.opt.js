var gadgets=gadgets||{};gadgets.i18n=gadgets.i18n||{};gadgets.i18n.NumberFormat=function(a){this.symbols_=a};gadgets.i18n.NumberFormat.prototype.applyStandardPattern=function(b,a){switch(b){case gadgets.i18n.DECIMAL_PATTERN:this.applyPattern(this.symbols_.DECIMAL_PATTERN,a);break;case gadgets.i18n.SCIENTIFIC_PATTERN:this.applyPattern(this.symbols_.SCIENTIFIC_PATTERN,a);break;case gadgets.i18n.PERCENT_PATTERN:this.applyPattern(this.symbols_.PERCENT_PATTERN,a);break;case gadgets.i18n.CURRENCY_PATTERN:this.applyPattern(this.symbols_.CURRENCY_PATTERN,a);break;default:throw Error("Unsupported pattern type.")}};gadgets.i18n.NumberFormat.prototype.applyPattern=function(b,a){this.pattern_=b;this.intlCurrencyCode_=a||this.symbols_.DEF_CURRENCY_CODE;this.currencySymbol_=gadgets.i18n.CurrencyCodeMap[this.intlCurrencyCode_];this.maximumIntegerDigits_=40;this.minimumIntegerDigits_=1;this.maximumFractionDigits_=3;this.minimumFractionDigits_=0;this.minExponentDigits_=0;this.positivePrefix_="";this.positiveSuffix_="";this.negativePrefix_="-";this.negativeSuffix_="";this.multiplier_=1;this.groupingSize_=3;this.decimalSeparatorAlwaysShown_=false;this.isCurrencyFormat_=false;this.useExponentialNotation_=false;this.parsePattern_(this.pattern_)};gadgets.i18n.NumberFormat.prototype.parse=function(e,d){var g=d||[0];var f=g[0];var a=0;var b=e.indexOf(this.positivePrefix_,g[0])==g[0];var c=e.indexOf(this.negativePrefix_,g[0])==g[0];if(b&&c){if(this.positivePrefix_.length>this.negativePrefix_.length){c=false}else{if(this.positivePrefix_.length<this.negativePrefix_.length){b=false}}}if(b){g[0]+=this.positivePrefix_.length}else{if(c){g[0]+=this.negativePrefix_.length}}if(e.indexOf(this.symbols_.INFINITY,g[0])==g[0]){g[0]+=this.symbols_.INFINITY.length;a=Infinity}else{a=this.parseNumber_(e,g)}if(b){if(!(e.indexOf(this.positiveSuffix_,g[0])==g[0])){g[0]=f;return 0}g[0]+=this.positiveSuffix_.length}else{if(c){if(!(e.indexOf(this.negativeSuffix_,g[0])==g[0])){g[0]=f;return 0}g[0]+=this.negativeSuffix_.length}}return c?-a:a};gadgets.i18n.NumberFormat.prototype.parseNumber_=function(l,j){var k=false;var h=false;var b=false;var f=1;var g=this.isCurrencyFormat_?this.symbols_.MONETARY_SEP:this.symbols_.DECIMAL_SEP;var d=this.isCurrencyFormat_?this.symbols_.MONETARY_GROUP_SEP:this.symbols_.GROUP_SEP;var c=this.symbols_.EXP_SYMBOL;var e="";for(;j[0]<l.length;j[0]++){var a=l.charAt(j[0]);var i=this.getDigit_(a);if(i>=0&&i<=9){e+=i;b=true}else{if(a==g.charAt(0)){if(k||h){break}e+=".";k=true}else{if(a==d.charAt(0)||"\u00a0"==d.charAt(0)&&a==" "&&j[0]+1<l.length&&this.getDigit_(l.charAt(j[0]+1))>=0){if(k||h){break}continue}else{if(a==c.charAt(0)){if(h){break}e+="E";h=true}else{if(a=="+"||a=="-"){e+=a}else{if(a==this.symbols_.PERCENT.charAt(0)){if(f!=1){break}f=100;if(b){j[0]++;break}}else{if(a==this.symbols_.PERMILL.charAt(0)){if(f!=1){break}f=1000;if(b){j[0]++;break}}else{break}}}}}}}}return parseFloat(e)/f};gadgets.i18n.NumberFormat.prototype.format=function(b){if(isNaN(b)){return this.symbols_.NAN}var c=[];var a=b<0||b==0&&1/b<0;c.push(a?this.negativePrefix_:this.positivePrefix_);if(!isFinite(b)){c.push(this.symbols_.INFINITY)}else{b*=a?-1:1;b*=this.multiplier_;this.useExponentialNotation_?this.subformatExponential_(b,c):this.subformatFixed_(b,this.minimumIntegerDigits_,c)}c.push(a?this.negativeSuffix_:this.positiveSuffix_);return c.join("")};gadgets.i18n.NumberFormat.prototype.subformatFixed_=function(g,f,j){var c=Math.pow(10,this.maximumFractionDigits_);g=Math.round(g*c);var b=Math.floor(g/c);var h=Math.floor(g-b*c);var m=this.minimumFractionDigits_>0||h>0;var a="";var q=b;while(q>100000000000000000000){a="0"+a;q=Math.round(q/10)}a=q+a;var l=this.isCurrencyFormat_?this.symbols_.MONETARY_SEP:this.symbols_.DECIMAL_SEP;var d=this.isCurrencyFormat_?this.symbols_.MONETARY_GROUP_SEP:this.symbols_.GROUP_SEP;var p=this.symbols_.ZERO_DIGIT.charCodeAt(0);var o=a.length;if(b>0||f>0){for(var k=o;k<f;k++){j.push(this.symbols_.ZERO_DIGIT)}for(var k=0;k<o;k++){j.push(String.fromCharCode(p+a.charAt(k)*1));if(o-k>1&&this.groupingSize_>0&&((o-k)%this.groupingSize_==1)){j.push(d)}}}else{if(!m){j.push(this.symbols_.ZERO_DIGIT)}}if(this.decimalSeparatorAlwaysShown_||m){j.push(l)}var e=""+(h+c);var n=e.length;while(e.charAt(n-1)=="0"&&n>this.minimumFractionDigits_+1){n--}for(var k=1;k<n;k++){j.push(String.fromCharCode(p+e.charAt(k)*1))}};gadgets.i18n.NumberFormat.prototype.addExponentPart_=function(b,c){c.push(this.symbols_.EXP_SYMBOL);if(b<0){b=-b;c.push(this.symbols_.MINUS_SIGN)}var d=""+b;for(var a=d.length;a<this.minExponentDigits_;a++){c.push(this.symbols_.ZERO_DIGIT)}c.push(d)};gadgets.i18n.NumberFormat.prototype.subformatExponential_=function(a,d){if(a==0){this.subformatFixed_(a,this.minimumIntegerDigits_,d);this.addExponentPart_(0,d);return}var b=Math.floor(Math.log(a)/Math.log(10));a/=Math.pow(10,b);var c=this.minimumIntegerDigits_;if(this.maximumIntegerDigits_>1&&this.maximumIntegerDigits_>this.minimumIntegerDigits_){while((b%this.maximumIntegerDigits_)!=0){a*=10;b--}c=1}else{if(this.minimumIntegerDigits_<1){b++;a/=10}else{b-=this.minimumIntegerDigits_-1;a*=Math.pow(10,this.minimumIntegerDigits_-1)}}this.subformatFixed_(a,c,d);this.addExponentPart_(b,d)};gadgets.i18n.NumberFormat.prototype.getDigit_=function(b){var c=b.charCodeAt(0);if(48<=c&&c<58){return c-48}else{var a=this.symbols_.ZERO_DIGIT.charCodeAt(0);return a<=c&&c<a+10?c-a:-1}};gadgets.i18n.NumberFormat.PATTERN_ZERO_DIGIT_="0";gadgets.i18n.NumberFormat.PATTERN_GROUPING_SEPARATOR_=",";gadgets.i18n.NumberFormat.PATTERN_DECIMAL_SEPARATOR_=".";gadgets.i18n.NumberFormat.PATTERN_PER_MILLE_="\u2030";gadgets.i18n.NumberFormat.PATTERN_PERCENT_="%";gadgets.i18n.NumberFormat.PATTERN_DIGIT_="#";gadgets.i18n.NumberFormat.PATTERN_SEPARATOR_=";";gadgets.i18n.NumberFormat.PATTERN_EXPONENT_="E";gadgets.i18n.NumberFormat.PATTERN_MINUS_="-";gadgets.i18n.NumberFormat.PATTERN_CURRENCY_SIGN_="\u00A4";gadgets.i18n.NumberFormat.QUOTE_="'";gadgets.i18n.NumberFormat.prototype.parseAffix_=function(d,f){var b="";var e=false;var a=d.length;for(;f[0]<a;f[0]++){var c=d.charAt(f[0]);if(c==gadgets.i18n.NumberFormat.QUOTE_){if(f[0]+1<a&&d.charAt(f[0]+1)==gadgets.i18n.NumberFormat.QUOTE_){f[0]++;b+="'"}else{e=!e}continue}if(e){b+=c}else{switch(c){case gadgets.i18n.NumberFormat.PATTERN_DIGIT_:case gadgets.i18n.NumberFormat.PATTERN_ZERO_DIGIT_:case gadgets.i18n.NumberFormat.PATTERN_GROUPING_SEPARATOR_:case gadgets.i18n.NumberFormat.PATTERN_DECIMAL_SEPARATOR_:case gadgets.i18n.NumberFormat.PATTERN_SEPARATOR_:return b;case gadgets.i18n.NumberFormat.PATTERN_CURRENCY_SIGN_:this.isCurrencyFormat_=true;if((f[0]+1)<a&&d.charAt(f[0]+1)==gadgets.i18n.NumberFormat.PATTERN_CURRENCY_SIGN_){f[0]++;b+=this.intlCurrencyCode_}else{b+=this.currencySymbol_}break;case gadgets.i18n.NumberFormat.PATTERN_PERCENT_:if(this.multiplier_!=1){throw Error("Too many percent/permill")}this.multiplier_=100;b+=this.symbols_.PERCENT;break;case gadgets.i18n.NumberFormat.PATTERN_PER_MILLE_:if(this.multiplier_!=1){throw Error("Too many percent/permill")}this.multiplier_=1000;b+=this.symbols_.PERMILL;break;default:b+=c}}}return b};gadgets.i18n.NumberFormat.prototype.parseTrunk_=function(g,i){var h=-1;var m=0;var c=0;var e=0;var k=-1;var f=g.length;for(var d=true;i[0]<f&&d;i[0]++){var a=g.charAt(i[0]);switch(a){case gadgets.i18n.NumberFormat.PATTERN_DIGIT_:if(c>0){e++}else{m++}if(k>=0&&h<0){k++}break;case gadgets.i18n.NumberFormat.PATTERN_ZERO_DIGIT_:if(e>0){throw Error('Unexpected "0" in pattern "'+g+'"')}c++;if(k>=0&&h<0){k++}break;case gadgets.i18n.NumberFormat.PATTERN_GROUPING_SEPARATOR_:k=0;break;case gadgets.i18n.NumberFormat.PATTERN_DECIMAL_SEPARATOR_:if(h>=0){throw Error('Multiple decimal separators in pattern "'+g+'"')}h=m+c+e;break;case gadgets.i18n.NumberFormat.PATTERN_EXPONENT_:if(this.useExponentialNotation_){throw Error('Multiple exponential symbols in pattern "'+g+'"')}this.useExponentialNotation_=true;this.minExponentDigits_=0;while((i[0]+1)<f&&g.charAt(i[0]+1)==this.symbols_.ZERO_DIGIT.charAt(0)){i[0]++;this.minExponentDigits_++}if((m+c)<1||this.minExponentDigits_<1){throw Error('Malformed exponential pattern "'+g+'"')}d=false;break;default:i[0]--;d=false;break}}if(c==0&&m>0&&h>=0){var b=h;if(b==0){b++}e=m-b;m=b-1;c=1}if(h<0&&e>0||h>=0&&(h<m||h>m+c)||k==0){throw Error('Malformed pattern "'+g+'"')}var l=m+c+e;this.maximumFractionDigits_=h>=0?l-h:0;if(h>=0){this.minimumFractionDigits_=m+c-h;if(this.minimumFractionDigits_<0){this.minimumFractionDigits_=0}}var j=h>=0?h:l;this.minimumIntegerDigits_=j-m;if(this.useExponentialNotation_){this.maximumIntegerDigits_=m+this.minimumIntegerDigits_;if(this.maximumFractionDigits_==0&&this.minimumIntegerDigits_==0){this.minimumIntegerDigits_=1}}this.groupingSize_=Math.max(0,k);this.decimalSeparatorAlwaysShown_=h==0||h==l};gadgets.i18n.NumberFormat.prototype.parsePattern_=function(b){var d=[0];this.positivePrefix_=this.parseAffix_(b,d);var c=d[0];this.parseTrunk_(b,d);var a=d[0]-c;this.positiveSuffix_=this.parseAffix_(b,d);if(d[0]<b.length&&b.charAt(d[0])==gadgets.i18n.NumberFormat.PATTERN_SEPARATOR_){d[0]++;this.negativePrefix_=this.parseAffix_(b,d);d[0]+=a;this.negativeSuffix_=this.parseAffix_(b,d)}};