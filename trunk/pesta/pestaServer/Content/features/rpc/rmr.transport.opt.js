var gadgets=gadgets||{};gadgets.rpctx=gadgets.rpctx||{};gadgets.rpctx.rmr=function(){var g=500;var e=10;var h={};var b;var i;function k(o,m,n){var p=function(){document.body.appendChild(o);o.src="about:blank";o.src=m+"#"+n};if(document.body){p()}else{gadgets.util.registerOnLoadHandler(function(){p()})}}function c(o){if(typeof h[o]==="object"){return}var p=document.createElement("iframe");var m=p.style;m.position="absolute";m.top="0px";m.border="0";m.opacity="0";m.width="10px";m.height="1px";p.id="rmrtransport-"+o;p.name=p.id;var n=gadgets.rpc.getOrigin(gadgets.rpc.getRelayUrl(o))+"/robots.txt";h[o]={frame:p,receiveWindow:null,relayUri:n,searchCounter:0,width:10,waiting:true,queue:[],sendId:0,recvId:0};if(o!==".."){k(p,n,a(o))}d(o)}function d(n){var o=null;h[n].searchCounter++;if(n===".."){o=window.parent.frames["rmrtransport-"+window.name]}else{o=window.frames[n].frames["rmrtransport-.."]}var m=false;if(o){m=f(n,o)}if(!m){if(h[n].searchCounter>e){return}setTimeout(function(){d(n)},g)}}function j(n,p,t,s){var o=null;if(t!==".."){o=h[".."]}else{o=h[n]}if(o){if(p!==gadgets.rpc.ACK){o.queue.push(s)}if(o.waiting||(o.queue.length===0&&!(p===gadgets.rpc.ACK&&s&&s.ackAlone===true))){return true}if(o.queue.length>0){o.waiting=true}var m=o.relayUri+"#"+a(n);try{o.frame.contentWindow.location=m;var q=o.width==10?20:10;o.frame.style.width=q+"px";o.width=q}catch(r){return false}}return true}function a(n){var o=h[n];var m={id:o.sendId};if(o){m.d=Array.prototype.slice.call(o.queue,0);m.d.push({s:gadgets.rpc.ACK,id:o.recvId})}return gadgets.json.stringify(m)}function l(x){var u=h[x];var q=u.receiveWindow.location.hash.substring(1);var y=gadgets.json.parse(decodeURIComponent(q))||{};var n=y.d||[];var o=false;var t=false;var v=0;var m=(u.recvId-y.id);for(var p=0;p<n.length;++p){var s=n[p];if(s.s===gadgets.rpc.ACK){i(x,true);if(u.waiting){t=true}u.waiting=false;var r=Math.max(0,s.id-u.sendId);u.queue.splice(0,r);u.sendId=Math.max(u.sendId,s.id||0);continue}o=true;if(++v<=m){continue}++u.recvId;b(s)}if(o||(t&&u.queue.length>0)){var w=(x==="..")?window.name:"..";j(x,gadgets.rpc.ACK,w,{ackAlone:o})}}function f(p,r){var o=h[p];try{var n=false;n="document" in r;if(!n){return false}n=typeof r.document=="object";if(!n){return false}var q=r.location.href;if(q==="about:blank"){return false}}catch(m){return false}o.receiveWindow=r;r.onresize=function(){l(p)};if(p===".."){k(o.frame,o.relayUri,a(p))}l(p);return true}return{getCode:function(){return"rmr"},isParentVerifiable:function(){return true},init:function(m,n){b=m;i=n;return true},setup:function(o,m){try{c(o)}catch(n){gadgets.warn("Caught exception setting up RMR: "+n);return false}return true},call:function(m,o,n){return j(m,n.s,o,n)}}}();