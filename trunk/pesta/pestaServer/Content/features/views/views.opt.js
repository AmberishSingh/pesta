var gadgets=gadgets||{};gadgets.views=function(){var e=null;var b={};var d={};function a(h){if(!h){h=window.event}var g;if(h.target){g=h.target}else{if(h.srcElement){g=h.srcElement}}if(g.nodeType===3){g=g.parentNode}if(g.nodeName.toLowerCase()==="a"){var f=g.getAttribute("href");if(f&&f[0]!=="#"&&f.indexOf("://")===-1){gadgets.views.requestNavigateTo(e,f);if(h.stopPropagation){h.stopPropagation()}if(h.preventDefault){h.preventDefault()}h.returnValue=false;h.cancelBubble=true;return false}}return false}function c(j){var h=j.views||{};for(var m in h){if(h.hasOwnProperty(m)){if(m!="rewriteLinks"){var n=h[m];if(!n){continue}b[m]=new gadgets.views.View(m,n.isOnlyVisible);var f=n.aliases||[];for(var l=0,k;k=f[l];++l){b[k]=new gadgets.views.View(m,n.isOnlyVisible)}}}}var g=gadgets.util.getUrlParameters();if(g["view-params"]){d=gadgets.json.parse(g["view-params"])||d}e=b[g.view]||b["default"];if(h.rewriteLinks){if(document.attachEvent){document.attachEvent("onclick",a)}else{document.addEventListener("click",a,false)}}}gadgets.config.register("views",null,c);return{bind:function(u,s){if(typeof u!="string"){throw new Error("Invalid urlTemplate")}if(typeof s!="object"){throw new Error("Invalid environment")}var q=/^([a-zA-Z0-9][a-zA-Z0-9_\.\-]*)(=([a-zA-Z0-9\-\._~]|(%[0-9a-fA-F]{2}))*)?$/,w=new RegExp("\\{([^}]*)\\}","g"),t=/^-([a-zA-Z]+)\|([^|]*)\|(.+)$/,m=[],p=0,k,j,h,o,l,g,n,r;function i(y,x){return s.hasOwnProperty(y)?s[y]:x}function f(x){if(!(j=x.match(q))){throw new Error("Invalid variable : "+x)}}function v(B,x,A){var y,z=B.split(",");for(y=0;y<z.length;++y){f(z[y]);if(A(x,i(j[1]),j[1])){break}}return x}while(k=w.exec(u)){m.push(u.substring(p,k.index));p=w.lastIndex;if(j=k[1].match(q)){h=j[1];o=j[2]?j[2].substr(1):"";m.push(i(h,o))}else{if(j=k[1].match(t)){l=j[1];g=j[2];n=j[3];r=0;switch(l){case"neg":r=1;case"opt":if(v(n,{flag:r},function(y,x){if(typeof x!="undefined"&&(typeof x!="object"||x.length)){y.flag=!y.flag;return 1}}).flag){m.push(g)}break;case"join":m.push(v(n,[],function(z,y,x){if(typeof y==="string"){z.push(x+"="+y)}}).join(g));break;case"list":f(n);value=i(j[1]);if(typeof value==="object"&&typeof value.join==="function"){m.push(value.join(g))}break;case"prefix":r=1;case"suffix":f(n);value=i(j[1],j[2]&&j[2].substr(1));if(typeof value==="string"){m.push(r?g+value:value+g)}else{if(typeof value==="object"&&typeof value.join==="function"){m.push(r?g+value.join(g):value.join(g)+g)}}break;default:throw new Error("Invalid operator : "+l)}}else{throw new Error("Invalid syntax : "+k[0])}}}m.push(u.substr(p));return m.join("")},requestNavigateTo:function(f,h,g){if(typeof f!=="string"){f=f.getName()}gadgets.rpc.call(null,"requestNavigateTo",null,f,h,g)},getCurrentView:function(){return e},getSupportedViews:function(){return b},getParams:function(){return d}}}();gadgets.views.View=function(a,b){this.name_=a;this.isOnlyVisible_=!!b};gadgets.views.View.prototype.getName=function(){return this.name_};gadgets.views.View.prototype.getUrlTemplate=function(){return gadgets.config&&gadgets.config.views&&gadgets.config.views[this.name_]&&gadgets.config.views[this.name_].urlTemplate};gadgets.views.View.prototype.bind=function(a){return gadgets.views.bind(this.getUrlTemplate(),a)};gadgets.views.View.prototype.isOnlyVisibleGadget=function(){return this.isOnlyVisible_};gadgets.views.ViewType=gadgets.util.makeEnum(["CANVAS","HOME","PREVIEW","PROFILE","FULL_PAGE","DASHBOARD","POPUP"]);